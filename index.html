# RH Management — Fullstack Website (FIXED: JSX/TSX parse errors)

**What's changed / why you saw the error**

You reported `SyntaxError: /index.tsx: Unexpected token (1:0)` when running the project. That error means the runtime/parser encountered JSX/TSX syntax in a file but your environment was not configured to transpile it (Node/Vite/Bundler couldn't understand the `<` at the top of the file). Common causes:

- You have a `.tsx` (TypeScript + JSX) file but you did not install/configure TypeScript (no `tsconfig.json`, no `typescript` dependency), or
- Your entry file is named `index.tsx` but your project is set up as a plain JavaScript (JSX) project (no TypeScript support), or
- You tried to run frontend files with `node` directly instead of using Vite/webpack/Babel.

**Two ways to fix** (choose one):

1. Convert project to plain JavaScript JSX (recommended for simplicity)
   - rename any `.tsx` files to `.jsx` (or create new `.jsx` entry files) and run using Vite's JS template.
   - No TypeScript dependencies needed.

2. Keep TypeScript (.tsx) but configure TypeScript + Vite
   - create `tsconfig.json` and install `typescript`, and ensure Vite is started (not `node index.tsx`).

This document below replaces the previous one and provides a ready-to-run **JSX (no TypeScript)** version (so you won't see the `index.tsx` parse error). If you *want* a TypeScript version instead, tell me and I'll switch files + add `tsconfig.json` + types dependencies.

---

## Overview

This repo contains a minimal fullstack implementation for **RH Management** with:

- `frontend/` — Vite + React + Tailwind (pure JS/JSX) single-page site
- `backend/` — Node.js + Express API using lowdb for a small JSON store, file uploads with multer
- `seed/` — initial data created by the backend on first run (admin seeded)

The critical change: frontend uses `.jsx` entry (`index.html` -> `src/main.jsx`) so there is no `index.tsx`. This removes the "Unexpected token" error caused by accidentally running TSX without TypeScript setup.

---

## Project structure (top-level)

```
rh-management/
├─ backend/
│  ├─ index.js
│  ├─ db.json        # lowdb file (auto-created)
│  ├─ uploads/       # images & videos uploaded by admin (auto-created)
│  ├─ package.json
├─ frontend/
│  ├─ index.html
│  ├─ package.json
│  ├─ src/
│  │  ├─ main.jsx
│  │  ├─ App.jsx
│  │  ├─ pages/Home.jsx
│  │  ├─ pages/Admin.jsx
│  │  └─ styles.css
└─ README.md
```

---

## Quick notes (security / warnings)

- Seeded admin credentials (present for initial login):
  - **Email:** rio.hutagalung2@gmail.com
  - **Password:** Taikbabi182

**Important:** Change the password immediately after the first login. Do not use this password in production.

---

## Backend — `backend/index.js` (unchanged behavior, minor compatibility note)

**Note about lowdb:** `lowdb` v5 is ESM-only. To keep CommonJS code simple for most local setups, this backend pins to a CommonJS-compatible usage. If you install `lowdb@^5.0.0` and get import errors, either install `lowdb@^3.0.0` instead or convert this file to ESM (`type": "module"` + `import` statements). The code below assumes a Node version that supports CommonJS `require`.

```js
// backend/index.js
const express = require('express');
const multer = require('multer');
const cors = require('cors');
const path = require('path');
const fs = require('fs');
const bcrypt = require('bcrypt');

// We'll use lowdb v3 style if available; if you installed v5, see note above
let Low, JSONFile;
try {
  ({ Low, JSONFile } = require('lowdb'));
} catch (err) {
  console.warn('lowdb require failed. If you installed lowdb@5+, please either install lowdb@^3 or convert to ESM.');
  // simple fallback - use a tiny JSON file wrapper
  const lowdbFallback = function(file) {
    const filepath = file.filename || file;
    return {
      read: async function() {
        try { this.data = JSON.parse(fs.readFileSync(filepath, 'utf8')); } catch(e){ this.data = {}; }
      },
      write: async function() { fs.writeFileSync(filepath, JSON.stringify(this.data,null,2)); }
    };
  };
  Low = class { constructor(a){ this.adapter = a; this.data = {}; } async read(){ try { this.data = JSON.parse(fs.readFileSync(this.adapter.filename,'utf8')) } catch(e){ this.data = {} } } async write(){ fs.writeFileSync(this.adapter.filename, JSON.stringify(this.data,null,2)) } };
  JSONFile = function(filename){ return { filename }; };
}

const app = express();
const PORT = process.env.PORT || 4000;

app.use(cors({ origin: 'http://localhost:5173', credentials: true }));
app.use(express.json());
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

// LowDB setup
const file = path.join(__dirname, 'db.json');
const adapter = new JSONFile(file);
const db = new Low(adapter);

async function initDB(){
  await db.read();
  db.data = db.data || {
    admin: { email: 'rio.hutagalung2@gmail.com', passwordHash: '' },
    content: {
      name: 'RH Management',
      base: 'Tangerang Selatan',
      contactWA: '6285121048961',
      email: 'contact@rhamanagement.co.id',
      legal: 'PT Bekat Melimpah Nusantara',
      established: '2022',
      description: 'RH Management didirikan sejak 2022 dan bergerak di bidang agency KOL (Nano, Mikro, Mega). Kami menyediakan layanan end-to-end untuk brand dan talent.',
      heroImage: '/uploads/hero.jpg',
      gallery: [],
      videos: []
    }
  };
  if(!db.data.admin.passwordHash){
    const hash = await bcrypt.hash('Taikbabi182', 10);
    db.data.admin.passwordHash = hash;
    await db.write();
    console.log('Seeded admin password hash.');
  }
}

const upload = multer({ dest: path.join(__dirname, 'uploads/') });

app.get('/api/content', async (req, res) => {
  await db.read();
  res.json(db.data.content);
});

app.post('/api/login', async (req, res) => {
  const { email, password } = req.body;
  await db.read();
  if(email !== db.data.admin.email) return res.status(401).json({ error: 'Invalid credentials' });
  const ok = await bcrypt.compare(password, db.data.admin.passwordHash);
  if(!ok) return res.status(401).json({ error: 'Invalid credentials' });
  const token = Buffer.from(email + '|' + Date.now()).toString('base64');
  db.data.admin.token = token;
  await db.write();
  res.json({ token });
});

async function auth(req, res, next){
  const token = req.headers['x-admin-token'];
  await db.read();
  if(db.data.admin.token && token === db.data.admin.token) return next();
  return res.status(403).json({ error: 'Forbidden' });
}

app.post('/api/content', auth, upload.single('file'), async (req, res) => {
  await db.read();
  const payload = req.body;
  if(req.file){
    const url = '/uploads/' + path.basename(req.file.path);
    if(payload.field === 'hero') db.data.content.heroImage = url;
    else {
      db.data.content.gallery = db.data.content.gallery || [];
      db.data.content.gallery.push(url);
    }
  }
  const allowed = ['name','base','contactWA','email','legal','established','description','videos'];
  allowed.forEach(k => { if(payload[k] !== undefined) db.data.content[k] = payload[k]; });
  await db.write();
  res.json({ ok: true, content: db.data.content });
});

app.post('/api/change-password', auth, async (req, res) => {
  const { newPassword } = req.body;
  if(!newPassword) return res.status(400).json({ error: 'Missing newPassword' });
  const hash = await bcrypt.hash(newPassword, 10);
  await db.read();
  db.data.admin.passwordHash = hash;
  db.data.admin.token = null;
  await db.write();
  res.json({ ok: true });
});

initDB().then(() => {
  if(!fs.existsSync(path.join(__dirname, 'uploads'))){ fs.mkdirSync(path.join(__dirname, 'uploads')); }
  app.listen(PORT, () => console.log('Backend running on http://localhost:' + PORT));
});
```

**Backend `package.json` (notes)**

- If you use `lowdb@5` (ESM), either convert `backend/index.js` to ESM or install `lowdb@^3.0.0` for CommonJS compatibility.

```json
{
  "name": "rh-backend",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": { "start": "node index.js" },
  "dependencies": {
    "bcrypt": "^5.1.0",
    "cors": "^2.8.5",
    "express": "^4.18.2",
    "lowdb": "^3.0.0",
    "multer": "^1.4.5"
  }
}
```

---

## Frontend (fixed to JSX) — files and code

**Important:** there is **no `index.tsx`** in this version. Use Vite's JS template.

### `frontend/index.html`

```html
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RH Management</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
```

### `frontend/src/main.jsx`

```jsx
import React from 'react';
import { createRoot } from 'react-dom/client';
import App from './App';
import './styles.css';

createRoot(document.getElementById('root')).render(<App />);
```

### `frontend/src/App.jsx`

```jsx
import { useState } from 'react';
import Home from './pages/Home';
import Admin from './pages/Admin';

export default function App(){
  const [isAdmin, setIsAdmin] = useState(false);
  return (
    <div className="min-h-screen font-sans">
      <main>
        {isAdmin ? <Admin onLogout={() => setIsAdmin(false)} /> : <Home onAdmin={() => setIsAdmin(true)} />}
      </main>
    </div>
  );
}
```

### `frontend/src/pages/Home.jsx`

```jsx
import { useEffect, useState } from 'react';

export default function Home(){
  const [c, setC] = useState(null);
  useEffect(()=>{ fetch('http://localhost:4000/api/content').then(r=>r.json()).then(setC); }, []);
  if(!c) return <div className="p-8">Loading…</div>;
  return (
    <div>
      <header className="bg-gray-900 text-white py-10">
        <div className="container mx-auto px-6">
          <h1 className="text-4xl font-bold">{c.name}</h1>
          <p className="mt-2">Based in {c.base} • Legal: {c.legal}</p>
        </div>
      </header>

      <section className="container mx-auto px-6 py-12">
        <div className="grid md:grid-cols-2 gap-8">
          <div>
            <img src={'http://localhost:4000' + c.heroImage} alt="hero" className="rounded-lg shadow" />
          </div>
          <div>
            <h2 className="text-2xl font-semibold">About RH Management</h2>
            <p className="mt-4">{c.description}</p>

            <div className="mt-6">
              <h3 className="font-semibold">Contact</h3>
              <p>WA: <a href={`https://wa.me/${c.contactWA}`}>{c.contactWA}</a></p>
              <p>Email: <a href={`mailto:${c.email}`}>{c.email}</a></p>
            </div>
          </div>
        </div>

        <div className="mt-12">
          <h3 className="text-xl font-semibold">Gallery</h3>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
            {(c.gallery||[]).map((g,i)=> (
              <img key={i} src={'http://localhost:4000' + g} className="rounded" alt={`gallery-${i}`} />
            ))}
          </div>
        </div>

      </section>

      <footer className="bg-gray-100 py-6 mt-12">
        <div className="container mx-auto px-6 text-sm">
          © {new Date().getFullYear()} {c.name} — Registered: {c.legal}
        </div>
      </footer>
    </div>
  );
}
```

### `frontend/src/pages/Admin.jsx`

```jsx
import { useState } from 'react';

export default function Admin({ onLogout }){
  const [token, setToken] = useState(null);
  const [content, setContent] = useState(null);
  const [form, setForm] = useState({});

  async function login(e){
    e.preventDefault();
    const email = e.target.email.value;
    const password = e.target.password.value;
    const res = await fetch('http://localhost:4000/api/login', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ email, password }) });
    if(!res.ok){ alert('Login failed'); return; }
    const j = await res.json();
    setToken(j.token);
    const c = await fetch('http://localhost:4000/api/content').then(r=>r.json());
    setContent(c); setForm(c);
  }

  async function save(e){
    e.preventDefault();
    const data = new FormData();
    // append all primitive form fields
    ['name','base','contactWA','email','legal','established','description'].forEach(k => data.append(k, form[k] || ''));
    // videos: array -> comma separated
    if(form.videos) data.append('videos', JSON.stringify(form.videos));
    if(form.file) data.append('file', form.file);
    data.append('field', form.field || 'gallery');
    const res = await fetch('http://localhost:4000/api/content', { method: 'POST', headers: { 'x-admin-token': token }, body: data });
    if(res.ok){ alert('Saved'); }
    else { alert('Failed to save'); }
  }

  if(!token) return (
    <div className="p-8">
      <h2 className="text-2xl font-semibold">Admin Login</h2>
      <form onSubmit={login} className="mt-4">
        <input name="email" defaultValue="rio.hutagalung2@gmail.com" className="border p-2 w-full mb-2" />
        <input name="password" type="password" defaultValue="Taikbabi182" className="border p-2 w-full mb-2" />
        <button className="bg-blue-600 text-white px-4 py-2 rounded">Login</button>
      </form>
    </div>
  );

  return (
    <div className="p-8">
      <div className="flex justify-between items-center">
        <h2 className="text-2xl font-semibold">Admin Dashboard</h2>
        <button onClick={() => { setToken(null); onLogout(); }} className="text-sm">Logout</button>
      </div>

      <form onSubmit={save} className="mt-6 space-y-4">
        <input value={form.name||''} onChange={e=>setForm({...form, name: e.target.value})} className="w-full border p-2" />
        <input value={form.base||''} onChange={e=>setForm({...form, base: e.target.value})} className="w-full border p-2" />
        <textarea value={form.description||''} onChange={e=>setForm({...form, description: e.target.value})} className="w-full border p-2 h-40" />
        <div>
          <label className="block">Upload hero image</label>
          <input type="file" name="file" onChange={e=>setForm({...form, file: e.target.files[0], field: 'hero'})} />
        </div>
        <div>
          <label>Add gallery image</label>
          <input type="file" name="file2" onChange={e=>setForm({...form, file: e.target.files[0], field: 'gallery'})} />
        </div>
        <div>
          <label>Videos (comma-separated URLs)</label>
          <input value={(form.videos||[]).join ? (form.videos||[]).join(',') : ''} onChange={e=>setForm({...form, videos: e.target.value.split(',')})} className="w-full border p-2" />
        </div>
        <button className="bg-green-600 text-white px-4 py-2 rounded">Save</button>
      </form>

    </div>
  );
}
```

### `frontend/src/styles.css` (minimal)

```css
/* Tailwind is optional; this is a fallback if you don't want to setup Tailwind immediately */
body{ font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
img{ max-width:100%; }
.container{ max-width:1100px; margin:0 auto; }
```

### `frontend/package.json`

```json
{
  "name": "rh-frontend",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "vite": "^5.0.0"
  }
}
```

**If you still want Tailwind:** install `tailwindcss`, create `tailwind.config.cjs` and `postcss` settings. The example `styles.css` is a minimal fallback so you can run without Tailwind.

---

## Sanity check / test scripts (added)

I added a simple shell script you can run to verify backend endpoints quickly (create file `sanity-check.sh` in project root):

```bash
#!/usr/bin/env bash
set -e
printf "\nGET /api/content:\n"
curl -s http://localhost:4000/api/content | jq || true
printf "\nPOST /api/login (use seeded credentials):\n"
curl -s -X POST http://localhost:4000/api/login -H "Content-Type: application/json" -d '{"email":"rio.hutagalung2@gmail.com","password":"Taikbabi182"}' | jq || true
```

Run backend (`node backend/index.js`) then run `./sanity-check.sh` (you need `jq` to pretty print; if not installed the script still shows raw JSON).

---

## Common pitfalls & fixes

- **If you still see `SyntaxError: Unexpected token` referencing `.tsx`** — search your project for `.tsx` files and either rename them to `.jsx` or switch to TypeScript:
  - To switch to TypeScript: run `npm i -D typescript @types/react @types/react-dom`, add `tsconfig.json`, and keep `.tsx` files.
  - To keep JavaScript: rename `.tsx` -> `.jsx` and ensure Vite entry `index.html` points to `/src/main.jsx`.

- **If backend errors about `lowdb` import** — make sure `lowdb` version is compatible. Use `npm i lowdb@^3.0.0` for the CommonJS style used here or convert `index.js` to ESM imports.

- **If you accidentally run `node src/main.jsx`** — that will fail. Start the frontend with Vite: `cd frontend && npm run dev`.

---

## How to run locally (step-by-step)

1. Backend
   ```bash
   cd backend
   npm install
   # ensure lowdb@^3 installed (if you want CommonJS). If you get lowdb ESM errors, run:
   # npm install lowdb@^3.0.0
   node index.js
   ```
   Backend runs on http://localhost:4000

2. Frontend
   ```bash
   cd frontend
   npm install
   npm run dev
   ```
   Frontend runs on http://localhost:5173

3. Sanity check (optional)
   ```bash
   # from project root (after backend started)
   ./sanity-check.sh
   ```

---

## Next steps — choose one and I'll implement it for you

- Convert the frontend to TypeScript properly (I will add `tsconfig.json`, rename `.jsx` to `.tsx`, and provide install commands), or
- Create a full GitHub-ready repo ZIP you can download, or
- Add Tailwind & prettier configs and a nicer design matching gushcloud.com exactly.

Also: do you expect any specific behavior I didn't cover? (e.g. CMS fields, extra pages, user roles). Tell me the expected behavior and I will add tests and adjust the code accordingly.

---

If you want, I can now push the corrected repo as a ZIP and include a single-command Dockerfile for easy deployment.
